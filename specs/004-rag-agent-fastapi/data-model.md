# Data Model: RAG Agent Development with OpenAI Agents SDK + FastAPI

This document defines the key entities and their attributes relevant to the RAG agent and its interaction with the FastAPI application.

## Entities

### 1. UserQuestion

Represents the input from the user to the RAG agent.

**Attributes**:
- `question` (string): The natural language question asked by the user.

### 2. AgentResponse

Represents the output from the RAG agent in response to a `UserQuestion`.

**Attributes**:
- `answer` (string): The natural language answer generated by the agent, grounded in the retrieved book content.
- `retrieved_chunks` (List of RetrievedDocumentChunk, optional): A list of the document chunks retrieved from Qdrant that were used to generate the answer. This is useful for debugging and transparency.

### 3. RetrievalTool

Represents the custom tool provided to the OpenAI Agent for retrieving information from the Qdrant vector database. This is a functional entity rather than a data entity.

**Function Signature (conceptual)**:
- `retrieve_book_content(query: str) -> str`: Takes a query string, performs a semantic search in Qdrant, and returns the concatenated text of the top-k relevant document chunks.

### 4. RetrievedDocumentChunk

Represents a single piece of text content retrieved from Qdrant by the `RetrievalTool`.

**Attributes**:
- `id` (string): The unique identifier of the vector in Qdrant.
- `text` (string): The text content of the chunk.
- `metadata` (Dictionary): The metadata associated with the chunk, including `source_url`, `book_title`, and `chunk_id`.
- `score` (float): The cosine similarity score of the chunk to the user's query.

## API Schemas (Pydantic Models)

These models will be used in the FastAPI application to define the request and response bodies for the API endpoints.

### AskRequest

The model for the request body of the `/ask` endpoint.

**Attributes**:
- `question` (string): The user's question.

### AskResponse

The model for the response body of the `/ask` endpoint.

**Attributes**:
- `answer` (string): The agent's answer.
- `retrieved_chunks` (List of RetrievedDocumentChunk, optional): The list of retrieved chunks.

## Relationships

- A `UserQuestion` is sent to the FastAPI endpoint.
- The endpoint invokes the OpenAI Agent, which uses the `RetrievalTool`.
- The `RetrievalTool` queries Qdrant and returns one or more `RetrievedDocumentChunk`s.
- The agent uses the content of the `RetrievedDocumentChunk`s to generate an `AgentResponse`.
- The `AgentResponse` is returned to the user via the FastAPI endpoint.
